import{computed as e,createElementBlock as i,openBlock as t,normalizeClass as o,createCommentVNode as a,toDisplayString as l,createBlock as s,createVNode as r,withModifiers as u,useTemplateRef as n,ref as d,watch as h,onBeforeUnmount as v,mergeModels as g,useModel as c,useSlots as p,unref as m,createElementVNode as y,renderSlot as k,Fragment as w,renderList as f}from"vue";const _="marking",M="move-rect",x="resize-left",z="resize-right",R="resize-top",S="resize-bottom",T=["x","y","width","height"],A={key:0},I={__name:"MarkUpRect",props:["x","y","width","height","isActive","isDragging","isVertical","isHorizontal","isProc","isShadow","title","isTitle"],setup(s){const r=s,u=e=>r.isProc&&(e=>!String(e).includes("px"))(e),n=e(()=>u(r.x)?`${r.x}%`:r.x),d=e(()=>u(r.y)?`${r.y}%`:r.y),h=e(()=>u(r.width)?`${r.width}%`:r.width),v=e(()=>u(r.height)?`${r.height}%`:r.height),g=e(()=>r.isTitle&&r?.title),c=e(()=>({"mark-up__rect_active":r.isActive,"mark-up__rect_dragging":r.isDragging,"mark-up__rect_vertical":r.isVertical,"mark-up__rect_horizontal":r.isHorizontal,"mark-up__rect_shadow":r.isShadow}));return(e,s)=>(t(),i("rect",{x:n.value,y:d.value,width:h.value,height:v.value,class:o(["mark-up__rect",c.value])},[g.value?(t(),i("title",A,"\r\n      "+l(r.title)+"\r\n    ",1)):a("",!0)],10,T))}},D=["id"],H={key:1},b="5px",U={__name:"MarkUpGroup",props:["x","y","id","width","height","isActive","isUnvisible","isResizeArea","isDragging","isProc","isShadow","isReadonly","title","isTitle"],emits:["move-left","move-right","move-top","move-bottom","hovered-id","reset-hovered-id"],setup(l,{emit:n}){const d=n,h=l,v=e(()=>!(h.isReadonly||!h.isResizeArea)),g=e(()=>["mark-up__g",{"mark-up__g_active":h.isActive,"mark-up__g_unvisible":h.isUnvisible}]);return(e,n)=>(t(),i("g",{id:h.id,class:o(g.value),onMouseover:n[8]||(n[8]=e=>d("hovered-id")),onMouseout:n[9]||(n[9]=e=>d("reset-hovered-id"))},[h.isShadow?(t(),s(I,{key:0,x:h.x,y:h.y,width:l.width,height:l.height,"is-shadow":!0,"is-proc":h.isProc},null,8,["x","y","width","height","is-proc"])):a("",!0),r(I,{x:h.x,y:h.y,width:l.width,height:l.height,title:l.title,"is-title":l.isTitle,"is-active":h.isActive,"is-dragging":h.isDragging,"is-proc":h.isProc},null,8,["x","y","width","height","title","is-title","is-active","is-dragging","is-proc"]),v.value?(t(),i("g",H,[r(I,{x:h.x,y:h.y,width:b,height:l.height,"is-vertical":!0,"is-proc":h.isProc,onMousedown:n[0]||(n[0]=u(e=>d("move-left",e),["stop"])),onTouchstart:n[1]||(n[1]=u(e=>d("move-left",e),["stop"]))},null,8,["x","y","height","is-proc"]),r(I,{x:h.x+l.width,y:h.y,width:b,height:l.height,"is-vertical":!0,"is-proc":h.isProc,onMousedown:n[2]||(n[2]=u(e=>d("move-right",e),["stop"])),onTouchstart:n[3]||(n[3]=u(e=>d("move-right",e),["stop"]))},null,8,["x","y","height","is-proc"]),r(I,{x:h.x,y:h.y,width:l.width,height:b,"is-horizontal":!0,"is-proc":h.isProc,onMousedown:n[4]||(n[4]=u(e=>d("move-top",e),["stop"])),onTouchstart:n[5]||(n[5]=u(e=>d("move-top",e),["stop"]))},null,8,["x","y","width","is-proc"]),r(I,{x:h.x,y:h.y+l.height,width:l.width,height:b,"is-horizontal":!0,"is-proc":h.isProc,onMousedown:n[6]||(n[6]=u(e=>d("move-bottom",e),["stop"])),onTouchstart:n[7]||(n[7]=u(e=>d("move-bottom",e),["stop"]))},null,8,["x","y","width","is-proc"])])):a("",!0)],42,D))}},B=(e,i=!1)=>{let t=e.offsetX,o=e.offsetY;if(e.targetTouches){const{left:a,top:l}=e.target.getBoundingClientRect(),{pageX:s,pageY:r}=e.targetTouches[0];t=i?s-a:s,o=i?r-l:r}return{x:t,y:o}},G={class:"mark-up__wrapper"},W=["src"],P={class:"mark-up__svg"},V={__name:"MarkUp",props:g({imageSrc:{type:[Object,String]},isMarkup:{type:Boolean,default:!0},enableGrid:{type:Boolean,default:!1},gridSize:{type:[Number,String],default:10,validator:e=>["5","10","15","20","25","30","35","40","45","50",5,10,15,20,25,30,35,40,45,50].includes(e)},minWidth:{type:[Number,String],default:10},minHeight:{type:[Number,String],default:10},isResizeArea:{type:Boolean,default:!0},isDraggingArea:{type:Boolean,default:!0},isReadonly:{type:Boolean,default:!1},resolution:{type:String,default:"HD",validator:e=>["16:9","HD","10:9","CIF","8:5","QHD","5:6","MPEG2","5:4","SXGA","5:3","WVGA","4:3","VGA","3:1","WSXGA","2:1","2K","1:1"].includes(e)},vertical:{type:Boolean,default:!1},isShadow:{type:Boolean,default:!1},theme:{type:String,default:"default"},isTitle:{type:Boolean,default:!0},keyTitle:{type:String,default:"title"}},{modelValue:{default:[]},modelModifiers:{},activeId:{default:null},activeIdModifiers:{},hoveredId:{default:null},hoveredIdModifiers:{}}),emits:g(["is-load-image","get-sizes"],["update:modelValue","update:activeId","update:hoveredId"]),setup(l,{emit:r}){const g=c(l,"modelValue"),T=c(l,"activeId"),A=c(l,"hoveredId"),I=d({}),D=r,H=e=>A.value=e,b=()=>A.value=null,V=p(),L=l,{widthMarkUp:X,heightMarkUp:$,convToPercent:C,convToRealWidth:N,convToRealHeight:E,minWidth:F,minHeight:j,imgSrc:K,isLoadImg:O}=((i,{cIsLoadImage:t,getSizes:o})=>{const a=n("img"),l=d(null),s=d(null),r=d(null),u=d(null),g=d(!1),c=()=>{g.value=!1,l.value=null,s.value=null,r.value=null,u.value=null},p=e(()=>{if(i.imageSrc&&"object"==typeof i.imageSrc){const e=new Blob(i.imageSrc,{type:"image"});return URL.createObjectURL(e)}return i.imageSrc&&"string"==typeof i.imageSrc?i.imageSrc:null}),m=()=>{if(p.value){const e=a.value.offsetHeight;l.value=a.value.offsetWidth,s.value=e,r.value=a.value.naturalWidth,u.value=a.value.naturalHeight,g.value=e>0}p.value||c()};let y;const k=()=>{y&&y.disconnect()},w=(e,i)=>e/i*100,f=(e,i)=>e*i.value/100,_=e(()=>w(i.minWidth,l.value)),M=e(()=>w(i.minHeight,s.value));return h(p,e=>{if(e){const i=new Image;i.src=e,i.onload=m,i.onerror=c}e||c()},{immediate:!0}),h(g,t),h(a,e=>{e||k(),e&&(k(),y=new ResizeObserver(m),y.observe(e))}),h([l,s,r,u],()=>{o({widthImage:l.value,heightImage:s.value,realWidthImage:r.value,realHeightImage:u.value})}),v(k),{widthMarkUp:l,heightMarkUp:s,convToPercent:w,convToRealWidth:e=>f(e,l),convToRealHeight:e=>f(e,s),minWidth:_,minHeight:M,imgSrc:p,isLoadImg:g}})(L,{cIsLoadImage:e=>D("is-load-image",e),getSizes:e=>D("get-sizes",e)});h(K,()=>{g.value=[],T.value=null,I.value={}});let Q=null,Y=null;const{markUpArea:q,startMarkup:J,marking:Z,mDownMarking:ee,mUpMarking:ie}=((e,{addInAreas:i,widthMarkUp:t,heightMarkUp:o})=>{const a=(e,i)=>e>i?i:e,l=e=>e<0?0:e,s=(e,i)=>e<0?i+e:i,r=d({}),u=d(!1);let n=null,h=null;return{markUpArea:r,startMarkup:u,marking:e=>{if(u.value&&n&&h){const{x:i,y:u}=B(e,!0),d=({sizeBlock:e,coord:i,size:t})=>{const o=i+t;return o>e?t-(o-e):t},v=a(n,i),g=a(h,u),c=d({sizeBlock:t.value,coord:v,size:Math.abs(n-i)}),p=d({sizeBlock:o.value,coord:g,size:Math.abs(h-u)});r.value={id:Date.now(),x:l(v),y:l(g),width:s(v,c),height:s(g,p)}}},mDownMarking:i=>{if(e.isMarkup){const{x:e,y:t}=B(i,!0);u.value=!0,n=e,h=t}},mUpMarking:()=>{if(e.isMarkup){u.value=!1,n=null,h=null;const t=r.value.width>=e.minWidth,o=r.value.height>=e.minHeight;t&&o&&i(r.value,r.value.id),r.value={}}}}})(L,{addInAreas:(e,i)=>{const t=(e=>{const{x:i,y:t,width:o,height:a}=e;return{...e,x:C(i,X.value),y:C(t,$.value),width:C(o,X.value),height:C(a,$.value)}})(e);g.value=[{...t},...g.value],T.value=i},widthMarkUp:X,heightMarkUp:$}),{isMovRect:te,mUpRect:oe,mDownRect:ae,moveRect:le,resizeRect:se}=(({cRectParam:e,convToRealWidth:i,convToRealHeight:t})=>{const o=d(!1);let a=null,l=null,s=null,r=null,u=null,n=null;const h=(e,i,t)=>i>=t?e+(i-t):e-(t-i),v=(e,i,t)=>i>=t?e-(i-t):e+(t-i);return{isMovRect:o,mUpRect:()=>{o.value=!1,a=null,l=null,s=null,r=null,u=null,n=null},mDownRect:(e,d)=>{const{x:h,y:v}=B(e);if(o.value=!0,a=h,l=v,d?.id){const{x:e,y:o,width:a,height:l}=d;s=i(e),r=t(o),u=i(a),n=t(l)}},moveRect:i=>{const{x:t,y:o}=B(i),u=h(s,t,a),n=h(r,o,l);e({x:u,y:n})},resizeRect:(i,t)=>{if(t===x){const{x:t}=B(i),o=h(s,t,a);if(o<s+u){const i=v(u,t,a);e({x:o,width:i})}}if(t===z){const{x:t}=B(i),o=h(u,t,a);e({width:o})}if(t===R){const{y:t}=B(i),o=h(r,t,l);if(o<r+n){const i=v(n,t,l);e({y:o,height:i})}}if(t===S){const{y:t}=B(i),o=h(n,t,l);e({height:o})}}}})({cRectParam:e=>{if(null!==Y){let i=(({x:e,y:i,width:t,height:o})=>{let a={};return e&&(a={...a,x:C(e,X.value)}),i&&(a={...a,y:C(i,$.value)}),t&&(a={...a,width:C(t,X.value)}),o&&(a={...a,height:C(o,$.value)}),a})(e);i={...g.value[Y],...i},((e,i)=>{const{x:t,y:o,width:a,height:l}=i;let s=l>=j.value&&a>=F.value;return e===x&&t<0&&(s=!1),e===z&&t+a>100&&(s=!1),e===S&&o+l>100&&(s=!1),e===R&&o<0&&(s=!1),s})(Q,i)&&(Q===M&&(i=(e=>{const i={...e};return i.x<0&&(i.x=0),i.y<0&&(i.y=0),i.x+i.width>100&&(i.x+=100-(i.x+i.width)),i.y+i.height>100&&(i.y+=100-(i.y+i.height)),i})(i)),g.value[Y]={...i},I.value={...i})}},convToRealWidth:N,convToRealHeight:E}),re=e=>{Q=e},ue=e(()=>!L.isReadonly&&null!==K.value),ne=e(()=>!!ue.value&&(L.isMarkup||L.isResizeArea||L.isDraggingArea)),de=e=>{if(ne.value&&e.preventDefault(),Q&&ue.value){const i=Q===M&&L.isDraggingArea,t=!i&&Q!==_,o=i=>{Q===i&&se(e,i)};Q===_&&Z(e),i&&le(e),t&&o(Q)}},he=e=>{ne.value&&e.preventDefault(),ue.value&&(re(_),ee(e))},ve=e=>{ne.value&&e.preventDefault(),ue.value&&(Q===_&&ie(),oe(),re(null))},ge=(e,i,t)=>{ne.value&&e.preventDefault();const o=e=>T.value=e;if(!L.isReadonly&&null!==K.value)if(t!==M||L.isDraggingArea){if(re(t),ae(e,i),i?.id){const{id:e}=i;o(e),Y=g.value.findIndex(i=>i.id===e)}}else i?.id&&o(i.id)},ce=((i,{startMarkup:t,isMovRect:o,isLoadImg:a})=>e(()=>[`mark-up_theme_${i.theme}`,{"mark-up_start":t.value,"mark-up_rect-move":o.value,"mark-up_rect-no-move":!i.isDraggingArea,"mark-up_readonly":i.isReadonly,"mark-up_is-image":a.value,"mark-up_no-markup":!i.isMarkup,"mark-up_grid":i.enableGrid,"mark-up_grid-10":10==i.gridSize,"mark-up_grid-15":15==i.gridSize,"mark-up_grid-20":20==i.gridSize,"mark-up_grid-25":25==i.gridSize,"mark-up_grid-30":30==i.gridSize,"mark-up_grid-35":35==i.gridSize,"mark-up_grid-40":40==i.gridSize,"mark-up_grid-45":45==i.gridSize,"mark-up_grid-50":50==i.gridSize,"mark-up_vertical":i.vertical,"mark-up_16-9":"16:9"===i.resolution,"mark-up_HD":"HD"===i.resolution,"mark-up_10-9":"10:9"===i.resolution,"mark-up_CIF":"CIF"===i.resolution,"mark-up_8-5":"8:5"===i.resolution,"mark-up_QHD":"QHD"===i.resolution,"mark-up_5-6":"5:6"===i.resolution,"mark-up_MPEG2":"MPEG2"===i.resolution,"mark-up_5-4":"5:4"===i.resolution,"mark-up_SXGA":"SXGA"===i.resolution,"mark-up_5-3":"5:3"===i.resolution,"mark-up_WVGA":"WVGA"===i.resolution,"mark-up_4-3":"4:3"===i.resolution,"mark-up_VGA":"VGA"===i.resolution,"mark-up_3-1":"3:1"===i.resolution,"mark-up_WSXGA":"WSXGA"===i.resolution,"mark-up_2-1":"2:1"===i.resolution,"mark-up_2K":"2K"===i.resolution,"mark-up_1-1":"1:1"===i.resolution}]))(L,{startMarkup:J,isMovRect:te,isLoadImg:O});return h(T,e=>I.value=g.value.find(i=>i.id===e),{immediate:!0}),(e,r)=>(t(),i("div",{class:o(["mark-up",m(ce)]),onMousedown:he,onMousemove:de,onMouseup:ve,onTouchstart:he,onTouchmove:de,onTouchend:ve},[y("div",G,[m(K)?(t(),i("img",{key:0,src:m(K),ref:"img",class:"mark-up__img",alt:""},null,8,W)):a("",!0),(t(),i("svg",P,[m(V).first?(t(),i("g",{key:0,onMousedown:r[0]||(r[0]=u(()=>{},["stop"])),onMousemove:r[1]||(r[1]=u(()=>{},["stop"])),onMouseup:r[2]||(r[2]=u(()=>{},["stop"])),onTouchstart:r[3]||(r[3]=u(()=>{},["stop"])),onTouchmove:r[4]||(r[4]=u(()=>{},["stop"])),onTouchend:r[5]||(r[5]=u(()=>{},["stop"]))},[k(e.$slots,"first")],32)):a("",!0),(t(!0),i(w,null,f(g.value,e=>(t(),s(U,{key:e.id,id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,"is-unvisible":T.value===e.id&&!L.isReadonly,"is-resize-area":L.isResizeArea,"is-proc":!0,"is-shadow":L.isShadow,"is-readonly":l.isReadonly,title:e[L.keyTitle],isTitle:L.isTitle,onTouchstart:u(i=>ge(i,e,"move-rect"),["stop"]),onMousedown:u(i=>ge(i,e,"move-rect"),["stop"]),onMoveLeft:i=>ge(i,e,"resize-left"),onMoveRight:i=>ge(i,e,"resize-right"),onMoveTop:i=>ge(i,e,"resize-top"),onMoveBottom:i=>ge(i,e,"resize-bottom"),onHoveredId:i=>H(e.id),onResetHoveredId:b},null,8,["id","x","y","width","height","is-unvisible","is-resize-area","is-shadow","is-readonly","title","isTitle","onTouchstart","onMousedown","onMoveLeft","onMoveRight","onMoveTop","onMoveBottom","onHoveredId"]))),128)),m(q)?.id?(t(),s(U,{key:1,id:m(q).id,x:m(q).x,y:m(q).y,width:m(q).width,height:m(q).height,"is-active":!0,"is-dragging":!0,"is-proc":!1,"is-shadow":L.isShadow,"is-readonly":l.isReadonly},null,8,["id","x","y","width","height","is-shadow","is-readonly"])):a("",!0),I.value?.id?(t(),s(U,{key:2,id:I.value.id,x:I.value.x,y:I.value.y,width:I.value.width,height:I.value.height,"is-active":T.value===I.value.id&&!L.isReadonly,"is-resize-area":L.isResizeArea,"is-proc":!0,"is-shadow":L.isShadow,"is-readonly":l.isReadonly,title:I.value[L.keyTitle],isTitle:L.isTitle,onTouchstart:r[6]||(r[6]=u(e=>ge(e,I.value,"move-rect"),["stop"])),onMousedown:r[7]||(r[7]=u(e=>ge(e,I.value,"move-rect"),["stop"])),onMoveLeft:r[8]||(r[8]=e=>ge(e,I.value,"resize-left")),onMoveRight:r[9]||(r[9]=e=>ge(e,I.value,"resize-right")),onMoveTop:r[10]||(r[10]=e=>ge(e,I.value,"resize-top")),onMoveBottom:r[11]||(r[11]=e=>ge(e,I.value,"resize-bottom")),onHoveredId:r[12]||(r[12]=e=>H(I.value?.id)),onResetHoveredId:b},null,8,["id","x","y","width","height","is-active","is-resize-area","is-shadow","is-readonly","title","isTitle"])):a("",!0),m(V).last?(t(),i("g",{key:3,onMousedown:r[13]||(r[13]=u(()=>{},["stop"])),onMousemove:r[14]||(r[14]=u(()=>{},["stop"])),onMouseup:r[15]||(r[15]=u(()=>{},["stop"])),onTouchstart:r[16]||(r[16]=u(()=>{},["stop"])),onTouchmove:r[17]||(r[17]=u(()=>{},["stop"])),onTouchend:r[18]||(r[18]=u(()=>{},["stop"]))},[k(e.$slots,"last")],32)):a("",!0)])),k(e.$slots,"html")])],34))}};export{V as default};
