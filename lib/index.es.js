import{computed as e,createElementBlock as i,openBlock as t,normalizeClass as o,createCommentVNode as a,toDisplayString as s,createBlock as l,createVNode as r,withModifiers as u,useTemplateRef as n,ref as d,watch as h,onBeforeUnmount as g,mergeModels as v,useModel as c,useSlots as p,unref as m,createElementVNode as y,renderSlot as k,Fragment as w,renderList as _}from"vue";const f="marking",M="move-rect",x="resize-left",z="resize-right",R="resize-top",S="resize-bottom",T=["x","y","width","height"],A={key:0},D={__name:"MarkUpRect",props:["x","y","width","height","isActive","isDragging","isVertical","isHorizontal","isProc","isShadow","title","isTitle"],setup(l){const r=l,u=e=>r.isProc&&(e=>!String(e).includes("px"))(e),n=e(()=>u(r.x)?`${r.x}%`:r.x),d=e(()=>u(r.y)?`${r.y}%`:r.y),h=e(()=>u(r.width)?`${r.width}%`:r.width),g=e(()=>u(r.height)?`${r.height}%`:r.height),v=e(()=>r.isTitle&&r?.title),c=e(()=>({"mark-up__rect_active":r.isActive,"mark-up__rect_dragging":r.isDragging,"mark-up__rect_vertical":r.isVertical,"mark-up__rect_horizontal":r.isHorizontal,"mark-up__rect_shadow":r.isShadow}));return(e,l)=>(t(),i("rect",{x:n.value,y:d.value,width:h.value,height:g.value,class:o(["mark-up__rect",c.value])},[v.value?(t(),i("title",A,"\r\n      "+s(r.title)+"\r\n    ",1)):a("",!0)],10,T))}},b=["id"],I={key:1},U="5px",H={__name:"MarkUpGroup",props:["x","y","id","width","height","isActive","isUnvisible","isResizeArea","isDragging","isProc","isShadow","isReadonly","title","isTitle"],emits:["move-left","move-right","move-top","move-bottom"],setup(s,{emit:n}){const d=n,h=s,g=e(()=>!(h.isReadonly||!h.isResizeArea)),v=e(()=>["mark-up__g",{"mark-up__g_active":h.isActive,"mark-up__g_unvisible":h.isUnvisible}]);return(e,n)=>(t(),i("g",{id:h.id,class:o(v.value)},[h.isShadow?(t(),l(D,{key:0,x:h.x,y:h.y,width:s.width,height:s.height,"is-shadow":!0,"is-proc":h.isProc},null,8,["x","y","width","height","is-proc"])):a("",!0),r(D,{x:h.x,y:h.y,width:s.width,height:s.height,title:s.title,"is-title":s.isTitle,"is-active":h.isActive,"is-dragging":h.isDragging,"is-proc":h.isProc},null,8,["x","y","width","height","title","is-title","is-active","is-dragging","is-proc"]),g.value?(t(),i("g",I,[r(D,{x:h.x,y:h.y,width:U,height:s.height,"is-vertical":!0,"is-proc":h.isProc,onMousedown:n[0]||(n[0]=u(e=>d("move-left",e),["stop"])),onTouchstart:n[1]||(n[1]=u(e=>d("move-left",e),["stop"]))},null,8,["x","y","height","is-proc"]),r(D,{x:h.x+s.width,y:h.y,width:U,height:s.height,"is-vertical":!0,"is-proc":h.isProc,onMousedown:n[2]||(n[2]=u(e=>d("move-right",e),["stop"])),onTouchstart:n[3]||(n[3]=u(e=>d("move-right",e),["stop"]))},null,8,["x","y","height","is-proc"]),r(D,{x:h.x,y:h.y,width:s.width,height:U,"is-horizontal":!0,"is-proc":h.isProc,onMousedown:n[4]||(n[4]=u(e=>d("move-top",e),["stop"])),onTouchstart:n[5]||(n[5]=u(e=>d("move-top",e),["stop"]))},null,8,["x","y","width","is-proc"]),r(D,{x:h.x,y:h.y+s.height,width:s.width,height:U,"is-horizontal":!0,"is-proc":h.isProc,onMousedown:n[6]||(n[6]=u(e=>d("move-bottom",e),["stop"])),onTouchstart:n[7]||(n[7]=u(e=>d("move-bottom",e),["stop"]))},null,8,["x","y","width","is-proc"])])):a("",!0)],10,b))}},B=(e,i=!1)=>{let t=e.offsetX,o=e.offsetY;if(e.targetTouches){const{left:a,top:s}=e.target.getBoundingClientRect(),{pageX:l,pageY:r}=e.targetTouches[0];t=i?l-a:l,o=i?r-s:r}return{x:t,y:o}},G={class:"mark-up__wrapper"},W=["src"],P={class:"mark-up__svg"},V={__name:"MarkUp",props:v({imageSrc:{type:[Object,String]},isMarkup:{type:Boolean,default:!0},enableGrid:{type:Boolean,default:!1},gridSize:{type:[Number,String],default:10,validator:e=>["5","10","15","20","25","30","35","40","45","50",5,10,15,20,25,30,35,40,45,50].includes(e)},minWidth:{type:[Number,String],default:10},minHeight:{type:[Number,String],default:10},isResizeArea:{type:Boolean,default:!0},isDraggingArea:{type:Boolean,default:!0},isReadonly:{type:Boolean,default:!1},resolution:{type:String,default:"HD",validator:e=>["16:9","HD","10:9","CIF","8:5","QHD","5:6","MPEG2","5:4","SXGA","5:3","WVGA","4:3","VGA","3:1","WSXGA","2:1","2K","1:1"].includes(e)},vertical:{type:Boolean,default:!1},isShadow:{type:Boolean,default:!1},theme:{type:String,default:"default"},isTitle:{type:Boolean,default:!0},keyTitle:{type:String,default:"title"}},{modelValue:{default:[]},modelModifiers:{},activeId:{default:null},activeIdModifiers:{}}),emits:v(["is-load-image","get-sizes"],["update:modelValue","update:activeId"]),setup(s,{emit:r}){const v=c(s,"modelValue"),T=c(s,"activeId"),A=d({}),D=r,b=p(),I=s,{widthMarkUp:U,heightMarkUp:V,convToPercent:L,convToRealWidth:X,convToRealHeight:$,minWidth:C,minHeight:N,imgSrc:E,isLoadImg:F}=((i,{changeIsLoadImage:t,getSizes:o})=>{const a=n("img"),s=d(null),l=d(null),r=d(null),u=d(null),v=d(!1),c=()=>{v.value=!1,s.value=null,l.value=null,r.value=null,u.value=null},p=e(()=>{if(i.imageSrc&&"object"==typeof i.imageSrc){const e=new Blob(i.imageSrc,{type:"image"});return URL.createObjectURL(e)}return i.imageSrc&&"string"==typeof i.imageSrc?i.imageSrc:null}),m=()=>{if(p.value){const e=a.value.offsetHeight;s.value=a.value.offsetWidth,l.value=e,r.value=a.value.naturalWidth,u.value=a.value.naturalHeight,v.value=e>0}p.value||c()};let y;const k=()=>{y&&y.disconnect()},w=(e,i)=>e/i*100,_=(e,i)=>e*i.value/100,f=e(()=>w(i.minWidth,s.value)),M=e(()=>w(i.minHeight,l.value));return h(p,e=>{const i=new Image;i.src=e,i.onload=m,i.onerror=c},{immediate:!0}),h(v,t),h(a,e=>{e||k(),e&&(k(),y=new ResizeObserver(m),y.observe(e))}),h([s,l,r,u],()=>{o({widthImage:s.value,heightImage:l.value,realWidthImage:r.value,realHeightImage:u.value})}),g(k),{widthMarkUp:s,heightMarkUp:l,convToPercent:w,convToRealWidth:e=>_(e,s),convToRealHeight:e=>_(e,l),minWidth:f,minHeight:M,imgSrc:p,isLoadImg:v}})(I,{changeIsLoadImage:e=>D("is-load-image",e),getSizes:e=>D("get-sizes",e)});h(E,()=>{v.value=[],T.value=null,A.value={}});let j=null,K=null;const{markUpArea:O,startMarkup:Q,marking:Y,mDownMarking:q,mUpMarking:J}=((e,{addInAreas:i,widthMarkUp:t,heightMarkUp:o})=>{const a=(e,i)=>e>i?i:e,s=e=>e<0?0:e,l=(e,i)=>e<0?i+e:i,r=d({}),u=d(!1);let n=null,h=null;return{markUpArea:r,startMarkup:u,marking:e=>{if(u.value&&n&&h){const{x:i,y:u}=B(e,!0),d=({sizeBlock:e,coord:i,size:t})=>{const o=i+t;return o>e?t-(o-e):t},g=a(n,i),v=a(h,u),c=d({sizeBlock:t.value,coord:g,size:Math.abs(n-i)}),p=d({sizeBlock:o.value,coord:v,size:Math.abs(h-u)});r.value={id:Date.now(),x:s(g),y:s(v),width:l(g,c),height:l(v,p)}}},mDownMarking:i=>{if(e.isMarkup){const{x:e,y:t}=B(i,!0);u.value=!0,n=e,h=t}},mUpMarking:()=>{if(e.isMarkup){u.value=!1,n=null,h=null;const t=r.value.width>=e.minWidth,o=r.value.height>=e.minHeight;t&&o&&i(r.value,r.value.id),r.value={}}}}})(I,{addInAreas:(e,i)=>{const t=(e=>{const{x:i,y:t,width:o,height:a}=e;return{...e,x:L(i,U.value),y:L(t,V.value),width:L(o,U.value),height:L(a,V.value)}})(e);v.value=[{...t},...v.value],T.value=i},widthMarkUp:U,heightMarkUp:V}),{isMovRect:Z,mUpRect:ee,mDownRect:ie,moveRect:te,resizeRect:oe}=(({cRectParam:e,convToRealWidth:i,convToRealHeight:t})=>{const o=d(!1);let a=null,s=null,l=null,r=null,u=null,n=null;const h=(e,i,t)=>i>=t?e+(i-t):e-(t-i),g=(e,i,t)=>i>=t?e-(i-t):e+(t-i);return{isMovRect:o,mUpRect:()=>{o.value=!1,a=null,s=null,l=null,r=null,u=null,n=null},mDownRect:(e,d)=>{const{x:h,y:g}=B(e);if(o.value=!0,a=h,s=g,d?.id){const{x:e,y:o,width:a,height:s}=d;l=i(e),r=t(o),u=i(a),n=t(s)}},moveRect:i=>{const{x:t,y:o}=B(i),u=h(l,t,a),n=h(r,o,s);e({x:u,y:n})},resizeRect:(i,t)=>{if(t===x){const{x:t}=B(i),o=h(l,t,a);if(o<l+u){const i=g(u,t,a);e({x:o,width:i})}}if(t===z){const{x:t}=B(i),o=h(u,t,a);e({width:o})}if(t===R){const{y:t}=B(i),o=h(r,t,s);if(o<r+n){const i=g(n,t,s);e({y:o,height:i})}}if(t===S){const{y:t}=B(i),o=h(n,t,s);e({height:o})}}}})({cRectParam:e=>{if(null!==K){let i=(({x:e,y:i,width:t,height:o})=>{let a={};return e&&(a={...a,x:L(e,U.value)}),i&&(a={...a,y:L(i,V.value)}),t&&(a={...a,width:L(t,U.value)}),o&&(a={...a,height:L(o,V.value)}),a})(e);i={...v.value[K],...i},((e,i)=>{const{x:t,y:o,width:a,height:s}=i;let l=s>=N.value&&a>=C.value;return e===x&&t<0&&(l=!1),e===z&&t+a>100&&(l=!1),e===S&&o+s>100&&(l=!1),e===R&&o<0&&(l=!1),l})(j,i)&&(j===M&&(i=(e=>{const i={...e};return i.x<0&&(i.x=0),i.y<0&&(i.y=0),i.x+i.width>100&&(i.x+=100-(i.x+i.width)),i.y+i.height>100&&(i.y+=100-(i.y+i.height)),i})(i)),v.value[K]={...i},A.value={...i})}},convToRealWidth:X,convToRealHeight:$}),ae=e=>{j=e},se=e(()=>!I.isReadonly&&null!==E.value),le=e(()=>!!se.value&&(I.isMarkup||I.isResizeArea||I.isDraggingArea)),re=e=>{if(le.value&&e.preventDefault(),j&&se.value){const i=j===M&&I.isDraggingArea,t=!i&&j!==f,o=i=>{j===i&&oe(e,i)};j===f&&Y(e),i&&te(e),t&&o(j)}},ue=e=>{le.value&&e.preventDefault(),se.value&&(ae(f),q(e))},ne=e=>{le.value&&e.preventDefault(),se.value&&(j===f&&J(),ee(),ae(null))},de=(e,i,t)=>{le.value&&e.preventDefault();const o=e=>T.value=e;if(!I.isReadonly&&null!==E.value)if(t!==M||I.isDraggingArea){if(ae(t),ie(e,i),i?.id){const{id:e}=i;o(e),K=v.value.findIndex(i=>i.id===e)}}else i?.id&&o(i.id)},he=((i,{startMarkup:t,isMovRect:o,isLoadImg:a})=>e(()=>[`mark-up_theme_${i.theme}`,{"mark-up_start":t.value,"mark-up_rect-move":o.value,"mark-up_rect-no-move":!i.isDraggingArea,"mark-up_readonly":i.isReadonly,"mark-up_is-image":a.value,"mark-up_no-markup":!i.isMarkup,"mark-up_grid":i.enableGrid,"mark-up_grid-10":10==i.gridSize,"mark-up_grid-15":15==i.gridSize,"mark-up_grid-20":20==i.gridSize,"mark-up_grid-25":25==i.gridSize,"mark-up_grid-30":30==i.gridSize,"mark-up_grid-35":35==i.gridSize,"mark-up_grid-40":40==i.gridSize,"mark-up_grid-45":45==i.gridSize,"mark-up_grid-50":50==i.gridSize,"mark-up_vertical":i.vertical,"mark-up_16-9":"16:9"===i.resolution,"mark-up_HD":"HD"===i.resolution,"mark-up_10-9":"10:9"===i.resolution,"mark-up_CIF":"CIF"===i.resolution,"mark-up_8-5":"8:5"===i.resolution,"mark-up_QHD":"QHD"===i.resolution,"mark-up_5-6":"5:6"===i.resolution,"mark-up_MPEG2":"MPEG2"===i.resolution,"mark-up_5-4":"5:4"===i.resolution,"mark-up_SXGA":"SXGA"===i.resolution,"mark-up_5-3":"5:3"===i.resolution,"mark-up_WVGA":"WVGA"===i.resolution,"mark-up_4-3":"4:3"===i.resolution,"mark-up_VGA":"VGA"===i.resolution,"mark-up_3-1":"3:1"===i.resolution,"mark-up_WSXGA":"WSXGA"===i.resolution,"mark-up_2-1":"2:1"===i.resolution,"mark-up_2K":"2K"===i.resolution,"mark-up_1-1":"1:1"===i.resolution}]))(I,{startMarkup:Q,isMovRect:Z,isLoadImg:F});return h(T,e=>A.value=v.value.find(i=>i.id===e),{immediate:!0}),(e,r)=>(t(),i("div",{class:o(["mark-up",m(he)]),onMousedown:ue,onMousemove:re,onMouseup:ne,onTouchstart:ue,onTouchmove:re,onTouchend:ne},[y("div",G,[m(E)?(t(),i("img",{key:0,src:m(E),ref:"img",class:"mark-up__img",alt:""},null,8,W)):a("",!0),(t(),i("svg",P,[m(b).first?(t(),i("g",{key:0,onMousedown:r[0]||(r[0]=u(()=>{},["stop"])),onMousemove:r[1]||(r[1]=u(()=>{},["stop"])),onMouseup:r[2]||(r[2]=u(()=>{},["stop"])),onTouchstart:r[3]||(r[3]=u(()=>{},["stop"])),onTouchmove:r[4]||(r[4]=u(()=>{},["stop"])),onTouchend:r[5]||(r[5]=u(()=>{},["stop"]))},[k(e.$slots,"first")],32)):a("",!0),(t(!0),i(w,null,_(v.value,e=>(t(),l(H,{key:e.id,id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,"is-unvisible":T.value===e.id&&!I.isReadonly,"is-resize-area":I.isResizeArea,"is-proc":!0,"is-shadow":I.isShadow,"is-readonly":s.isReadonly,title:e[I.keyTitle],isTitle:I.isTitle,onTouchstart:u(i=>de(i,e,"move-rect"),["stop"]),onMousedown:u(i=>{de(i,e,"move-rect")},["stop"]),onMoveLeft:i=>de(i,e,"resize-left"),onMoveRight:i=>de(i,e,"resize-right"),onMoveTop:i=>de(i,e,"resize-top"),onMoveBottom:i=>de(i,e,"resize-bottom")},null,8,["id","x","y","width","height","is-unvisible","is-resize-area","is-shadow","is-readonly","title","isTitle","onTouchstart","onMousedown","onMoveLeft","onMoveRight","onMoveTop","onMoveBottom"]))),128)),m(O)?.id?(t(),l(H,{key:1,id:m(O).id,x:m(O).x,y:m(O).y,width:m(O).width,height:m(O).height,"is-active":!0,"is-dragging":!0,"is-proc":!1,"is-shadow":I.isShadow,"is-readonly":s.isReadonly},null,8,["id","x","y","width","height","is-shadow","is-readonly"])):a("",!0),A.value?.id?(t(),l(H,{key:2,id:A.value.id,x:A.value.x,y:A.value.y,width:A.value.width,height:A.value.height,"is-active":T.value===A.value.id&&!I.isReadonly,"is-resize-area":I.isResizeArea,"is-proc":!0,"is-shadow":I.isShadow,"is-readonly":s.isReadonly,title:A.value[I.keyTitle],isTitle:I.isTitle,onTouchstart:r[6]||(r[6]=u(e=>de(e,A.value,"move-rect"),["stop"])),onMousedown:r[7]||(r[7]=u(e=>de(e,A.value,"move-rect"),["stop"])),onMoveLeft:r[8]||(r[8]=e=>de(e,A.value,"resize-left")),onMoveRight:r[9]||(r[9]=e=>de(e,A.value,"resize-right")),onMoveTop:r[10]||(r[10]=e=>de(e,A.value,"resize-top")),onMoveBottom:r[11]||(r[11]=e=>de(e,A.value,"resize-bottom"))},null,8,["id","x","y","width","height","is-active","is-resize-area","is-shadow","is-readonly","title","isTitle"])):a("",!0),m(b).last?(t(),i("g",{key:3,onMousedown:r[12]||(r[12]=u(()=>{},["stop"])),onMousemove:r[13]||(r[13]=u(()=>{},["stop"])),onMouseup:r[14]||(r[14]=u(()=>{},["stop"])),onTouchstart:r[15]||(r[15]=u(()=>{},["stop"])),onTouchmove:r[16]||(r[16]=u(()=>{},["stop"])),onTouchend:r[17]||(r[17]=u(()=>{},["stop"]))},[k(e.$slots,"last")],32)):a("",!0)]))])],34))}};export{V as default};
