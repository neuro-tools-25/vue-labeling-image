import{computed as e,createElementBlock as i,openBlock as t,normalizeClass as a,createCommentVNode as o,toDisplayString as l,createBlock as r,createVNode as s,withModifiers as u,useTemplateRef as n,ref as d,watch as h,onBeforeUnmount as g,mergeModels as v,useModel as c,unref as m,createElementVNode as p,renderSlot as y,Fragment as k,renderList as w}from"vue";const _="marking",f="move-rect",M="resize-left",x="resize-right",z="resize-top",R="resize-bottom",S=["x","y","width","height"],T={key:0},A={__name:"MarkUpRect",props:["x","y","width","height","isActive","isDragging","isVertical","isHorizontal","isProc","isShadow","title","isTitle"],setup(r){const s=r,u=e=>s.isProc&&(e=>!String(e).includes("px"))(e),n=e(()=>u(s.x)?`${s.x}%`:s.x),d=e(()=>u(s.y)?`${s.y}%`:s.y),h=e(()=>u(s.width)?`${s.width}%`:s.width),g=e(()=>u(s.height)?`${s.height}%`:s.height),v=e(()=>s.isTitle&&s?.title),c=e(()=>({"mark-up__rect_active":s.isActive,"mark-up__rect_dragging":s.isDragging,"mark-up__rect_vertical":s.isVertical,"mark-up__rect_horizontal":s.isHorizontal,"mark-up__rect_shadow":s.isShadow}));return(e,r)=>(t(),i("rect",{x:n.value,y:d.value,width:h.value,height:g.value,class:a(["mark-up__rect",c.value])},[v.value?(t(),i("title",T,"\r\n      "+l(s.title)+"\r\n    ",1)):o("",!0)],10,S))}},D=["id"],b={key:1},I="5px",U={__name:"MarkUpGroup",props:["x","y","id","width","height","isActive","isUnvisible","isResizeArea","isDragging","isProc","isShadow","isReadonly","title","isTitle"],emits:["move-left","move-right","move-top","move-bottom"],setup(l,{emit:n}){const d=n,h=l,g=e(()=>!(h.isReadonly||!h.isResizeArea)),v=e(()=>["mark-up__g",{"mark-up__g_active":h.isActive,"mark-up__g_unvisible":h.isUnvisible}]);return(e,n)=>(t(),i("g",{id:h.id,class:a(v.value)},[h.isShadow?(t(),r(A,{key:0,x:h.x,y:h.y,width:l.width,height:l.height,"is-shadow":!0,"is-proc":h.isProc},null,8,["x","y","width","height","is-proc"])):o("",!0),s(A,{x:h.x,y:h.y,width:l.width,height:l.height,title:l.title,"is-title":l.isTitle,"is-active":h.isActive,"is-dragging":h.isDragging,"is-proc":h.isProc},null,8,["x","y","width","height","title","is-title","is-active","is-dragging","is-proc"]),g.value?(t(),i("g",b,[s(A,{x:h.x,y:h.y,width:I,height:l.height,"is-vertical":!0,"is-proc":h.isProc,onMousedown:n[0]||(n[0]=u(e=>d("move-left",e),["stop"])),onTouchstart:n[1]||(n[1]=u(e=>d("move-left",e),["stop"]))},null,8,["x","y","height","is-proc"]),s(A,{x:h.x+l.width,y:h.y,width:I,height:l.height,"is-vertical":!0,"is-proc":h.isProc,onMousedown:n[2]||(n[2]=u(e=>d("move-right",e),["stop"])),onTouchstart:n[3]||(n[3]=u(e=>d("move-right",e),["stop"]))},null,8,["x","y","height","is-proc"]),s(A,{x:h.x,y:h.y,width:l.width,height:I,"is-horizontal":!0,"is-proc":h.isProc,onMousedown:n[4]||(n[4]=u(e=>d("move-top",e),["stop"])),onTouchstart:n[5]||(n[5]=u(e=>d("move-top",e),["stop"]))},null,8,["x","y","width","is-proc"]),s(A,{x:h.x,y:h.y+l.height,width:l.width,height:I,"is-horizontal":!0,"is-proc":h.isProc,onMousedown:n[6]||(n[6]=u(e=>d("move-bottom",e),["stop"])),onTouchstart:n[7]||(n[7]=u(e=>d("move-bottom",e),["stop"]))},null,8,["x","y","width","is-proc"])])):o("",!0)],10,D))}},H=(e,i=!1)=>{let t=e.offsetX,a=e.offsetY;if(e.targetTouches){const{left:o,top:l}=e.target.getBoundingClientRect(),{pageX:r,pageY:s}=e.targetTouches[0];t=i?r-o:r,a=i?s-l:s}return{x:t,y:a}},B={class:"mark-up__wrapper"},G=["src"],W={class:"mark-up__svg",width:"100%",height:"100%"},P={__name:"MarkUp",props:v({imageSrc:{type:[Object,String]},isMarkup:{type:Boolean,default:!0},enableGrid:{type:Boolean,default:!1},gridSize:{type:[Number,String],default:10,validator:e=>["5","10","15","20","25","30","35","40","45","50",5,10,15,20,25,30,35,40,45,50].includes(e)},minWidth:{type:[Number,String],default:10},minHeight:{type:[Number,String],default:10},isResizeArea:{type:Boolean,default:!0},isDraggingArea:{type:Boolean,default:!0},isReadonly:{type:Boolean,default:!1},resolution:{type:String,default:"HD",validator:e=>["16:9","HD","10:9","CIF","8:5","QHD","5:6","MPEG2","5:4","SXGA","5:3","WVGA","4:3","VGA","3:1","WSXGA","2:1","2K","1:1"].includes(e)},vertical:{type:Boolean,default:!1},isShadow:{type:Boolean,default:!1},theme:{type:String,default:"default"},isTitle:{type:Boolean,default:!0},keyTitle:{type:String,default:"title"}},{modelValue:{default:[]},modelModifiers:{},activeId:{default:null},activeIdModifiers:{}}),emits:v(["is-load-image","get-sizes"],["update:modelValue","update:activeId"]),setup(l,{emit:s}){const v=c(l,"modelValue"),S=c(l,"activeId"),T=d({}),A=s,D=l,{widthMarkUp:b,heightMarkUp:I,convToPercent:P,convToRealWidth:V,convToRealHeight:L,minWidth:X,minHeight:$,imgSrc:C,isLoadImg:N}=((i,{changeIsLoadImage:t,getSizes:a})=>{const o=n("img"),l=d(null),r=d(null),s=d(null),u=d(null),v=d(!1),c=()=>{v.value=!1,l.value=null,r.value=null,s.value=null,u.value=null},m=e(()=>{if(i.imageSrc&&"object"==typeof i.imageSrc){const e=new Blob(i.imageSrc,{type:"image"});return URL.createObjectURL(e)}return i.imageSrc&&"string"==typeof i.imageSrc?i.imageSrc:null}),p=()=>{if(m.value){const e=o.value.offsetHeight;l.value=o.value.offsetWidth,r.value=e,s.value=o.value.naturalWidth,u.value=o.value.naturalHeight,v.value=e>0}m.value||c()};let y;const k=()=>{y&&y.disconnect()},w=(e,i)=>e/i*100,_=(e,i)=>e*i.value/100,f=e(()=>w(i.minWidth,l.value)),M=e(()=>w(i.minHeight,r.value));return h(m,e=>{const i=new Image;i.src=e,i.onload=p,i.onerror=c},{immediate:!0}),h(v,t),h(o,e=>{e||k(),e&&(k(),y=new ResizeObserver(p),y.observe(e))}),h([l,r,s,u],()=>{a({widthImage:l.value,heightImage:r.value,realWidthImage:s.value,realHeightImage:u.value})}),g(k),{widthMarkUp:l,heightMarkUp:r,convToPercent:w,convToRealWidth:e=>_(e,l),convToRealHeight:e=>_(e,r),minWidth:f,minHeight:M,imgSrc:m,isLoadImg:v}})(D,{changeIsLoadImage:e=>A("is-load-image",e),getSizes:e=>A("get-sizes",e)});h(C,()=>{v.value=[],S.value=null,T.value={}});let E=null,F=null;const{markUpArea:j,startMarkup:K,marking:O,mDownMarking:Q,mUpMarking:Y}=((e,{addInAreas:i,widthMarkUp:t,heightMarkUp:a})=>{const o=(e,i)=>e>i?i:e,l=e=>e<0?0:e,r=(e,i)=>e<0?i+e:i,s=d({}),u=d(!1);let n=null,h=null;return{markUpArea:s,startMarkup:u,marking:e=>{if(u.value&&n&&h){const{x:i,y:u}=H(e,!0),d=({sizeBlock:e,coord:i,size:t})=>{const a=i+t;return a>e?t-(a-e):t},g=o(n,i),v=o(h,u),c=d({sizeBlock:t.value,coord:g,size:Math.abs(n-i)}),m=d({sizeBlock:a.value,coord:v,size:Math.abs(h-u)});s.value={id:Date.now(),x:l(g),y:l(v),width:r(g,c),height:r(v,m)}}},mDownMarking:i=>{if(e.isMarkup){const{x:e,y:t}=H(i,!0);u.value=!0,n=e,h=t}},mUpMarking:()=>{if(e.isMarkup){u.value=!1,n=null,h=null;const t=s.value.width>=e.minWidth,a=s.value.height>=e.minHeight;t&&a&&i(s.value,s.value.id),s.value={}}}}})(D,{addInAreas:(e,i)=>{const t=(e=>{const{x:i,y:t,width:a,height:o}=e;return{...e,x:P(i,b.value),y:P(t,I.value),width:P(a,b.value),height:P(o,I.value)}})(e);v.value=[{...t},...v.value],S.value=i},widthMarkUp:b,heightMarkUp:I}),{isMovRect:q,mUpRect:J,mDownRect:Z,moveRect:ee,resizeRect:ie}=(({cRectParam:e,convToRealWidth:i,convToRealHeight:t})=>{const a=d(!1);let o=null,l=null,r=null,s=null,u=null,n=null;const h=(e,i,t)=>i>=t?e+(i-t):e-(t-i),g=(e,i,t)=>i>=t?e-(i-t):e+(t-i);return{isMovRect:a,mUpRect:()=>{a.value=!1,o=null,l=null,r=null,s=null,u=null,n=null},mDownRect:(e,d)=>{const{x:h,y:g}=H(e);if(a.value=!0,o=h,l=g,d?.id){const{x:e,y:a,width:o,height:l}=d;r=i(e),s=t(a),u=i(o),n=t(l)}},moveRect:i=>{const{x:t,y:a}=H(i),u=h(r,t,o),n=h(s,a,l);e({x:u,y:n})},resizeRect:(i,t)=>{if(t===M){const{x:t}=H(i),a=h(r,t,o);if(a<r+u){const i=g(u,t,o);e({x:a,width:i})}}if(t===x){const{x:t}=H(i),a=h(u,t,o);e({width:a})}if(t===z){const{y:t}=H(i),a=h(s,t,l);if(a<s+n){const i=g(n,t,l);e({y:a,height:i})}}if(t===R){const{y:t}=H(i),a=h(n,t,l);e({height:a})}}}})({cRectParam:e=>{if(null!==F){let i=(({x:e,y:i,width:t,height:a})=>{let o={};return e&&(o={...o,x:P(e,b.value)}),i&&(o={...o,y:P(i,I.value)}),t&&(o={...o,width:P(t,b.value)}),a&&(o={...o,height:P(a,I.value)}),o})(e);i={...v.value[F],...i},((e,i)=>{const{x:t,y:a,width:o,height:l}=i;let r=l>=$.value&&o>=X.value;return e===M&&t<0&&(r=!1),e===x&&t+o>100&&(r=!1),e===R&&a+l>100&&(r=!1),e===z&&a<0&&(r=!1),r})(E,i)&&(E===f&&(i=(e=>{const i={...e};return i.x<0&&(i.x=0),i.y<0&&(i.y=0),i.x+i.width>100&&(i.x+=100-(i.x+i.width)),i.y+i.height>100&&(i.y+=100-(i.y+i.height)),i})(i)),v.value[F]={...i},T.value={...i})}},convToRealWidth:V,convToRealHeight:L}),te=e=>{E=e},ae=e(()=>!D.isReadonly&&null!==C.value),oe=e(()=>!!ae.value&&(D.isMarkup||D.isResizeArea||D.isDraggingArea)),le=e=>{if(oe.value&&e.preventDefault(),E&&ae.value){const i=E===f&&D.isDraggingArea,t=!i&&E!==_,a=i=>{E===i&&ie(e,i)};E===_&&O(e),i&&ee(e),t&&a(E)}},re=e=>{oe.value&&e.preventDefault(),ae.value&&(te(_),Q(e))},se=e=>{oe.value&&e.preventDefault(),ae.value&&(E===_&&Y(),J(),te(null))},ue=(e,i,t)=>{oe.value&&e.preventDefault();const a=e=>S.value=e;if(!D.isReadonly&&null!==C.value)if(t!==f||D.isDraggingArea){if(te(t),Z(e,i),i?.id){const{id:e}=i;a(e),F=v.value.findIndex(i=>i.id===e)}}else i?.id&&a(i.id)},ne=((i,{startMarkup:t,isMovRect:a,isLoadImg:o})=>e(()=>[`mark-up_theme_${i.theme}`,{"mark-up_start":t.value,"mark-up_rect-move":a.value,"mark-up_rect-no-move":!i.isDraggingArea,"mark-up_readonly":i.isReadonly,"mark-up_is-image":o.value,"mark-up_no-markup":!i.isMarkup,"mark-up_grid":i.enableGrid,"mark-up_grid-10":10==i.gridSize,"mark-up_grid-15":15==i.gridSize,"mark-up_grid-20":20==i.gridSize,"mark-up_grid-25":25==i.gridSize,"mark-up_grid-30":30==i.gridSize,"mark-up_grid-35":35==i.gridSize,"mark-up_grid-40":40==i.gridSize,"mark-up_grid-45":45==i.gridSize,"mark-up_grid-50":50==i.gridSize,"mark-up_vertical":i.vertical,"mark-up_16-9":"16:9"===i.resolution,"mark-up_HD":"HD"===i.resolution,"mark-up_10-9":"10:9"===i.resolution,"mark-up_CIF":"CIF"===i.resolution,"mark-up_8-5":"8:5"===i.resolution,"mark-up_QHD":"QHD"===i.resolution,"mark-up_5-6":"5:6"===i.resolution,"mark-up_MPEG2":"MPEG2"===i.resolution,"mark-up_5-4":"5:4"===i.resolution,"mark-up_SXGA":"SXGA"===i.resolution,"mark-up_5-3":"5:3"===i.resolution,"mark-up_WVGA":"WVGA"===i.resolution,"mark-up_4-3":"4:3"===i.resolution,"mark-up_VGA":"VGA"===i.resolution,"mark-up_3-1":"3:1"===i.resolution,"mark-up_WSXGA":"WSXGA"===i.resolution,"mark-up_2-1":"2:1"===i.resolution,"mark-up_2K":"2K"===i.resolution,"mark-up_1-1":"1:1"===i.resolution}]))(D,{startMarkup:K,isMovRect:q,isLoadImg:N});return h(S,e=>T.value=v.value.find(i=>i.id===e)),(e,s)=>(t(),i("div",{class:a(["mark-up",m(ne)]),onMousedown:re,onMousemove:le,onMouseup:se,onTouchstart:re,onTouchmove:le,onTouchend:se},[p("div",B,[m(C)?(t(),i("img",{key:0,src:m(C),ref:"img",class:"mark-up__img",alt:""},null,8,G)):o("",!0),(t(),i("svg",W,[y(e.$slots,"first"),(t(!0),i(k,null,w(v.value,e=>(t(),r(U,{key:e.id,id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,"is-unvisible":S.value===e.id&&!D.isReadonly,"is-resize-area":D.isResizeArea,"is-proc":!0,"is-shadow":D.isShadow,"is-readonly":l.isReadonly,title:e[D.keyTitle],isTitle:D.isTitle,onTouchstart:u(i=>ue(i,e,"move-rect"),["stop"]),onMousedown:u(i=>{ue(i,e,"move-rect")},["stop"]),onMoveLeft:i=>ue(i,e,"resize-left"),onMoveRight:i=>ue(i,e,"resize-right"),onMoveTop:i=>ue(i,e,"resize-top"),onMoveBottom:i=>ue(i,e,"resize-bottom")},null,8,["id","x","y","width","height","is-unvisible","is-resize-area","is-shadow","is-readonly","title","isTitle","onTouchstart","onMousedown","onMoveLeft","onMoveRight","onMoveTop","onMoveBottom"]))),128)),m(j)?.id?(t(),r(U,{key:0,id:m(j).id,x:m(j).x,y:m(j).y,width:m(j).width,height:m(j).height,"is-active":!0,"is-dragging":!0,"is-proc":!1,"is-shadow":D.isShadow,"is-readonly":l.isReadonly},null,8,["id","x","y","width","height","is-shadow","is-readonly"])):o("",!0),T.value?.id?(t(),r(U,{key:1,id:T.value.id,x:T.value.x,y:T.value.y,width:T.value.width,height:T.value.height,"is-active":S.value===T.value.id&&!D.isReadonly,"is-resize-area":D.isResizeArea,"is-proc":!0,"is-shadow":D.isShadow,"is-readonly":l.isReadonly,title:T.value[D.keyTitle],isTitle:D.isTitle,onTouchstart:s[0]||(s[0]=u(e=>ue(e,T.value,"move-rect"),["stop"])),onMousedown:s[1]||(s[1]=u(e=>ue(e,T.value,"move-rect"),["stop"])),onMoveLeft:s[2]||(s[2]=e=>ue(e,T.value,"resize-left")),onMoveRight:s[3]||(s[3]=e=>ue(e,T.value,"resize-right")),onMoveTop:s[4]||(s[4]=e=>ue(e,T.value,"resize-top")),onMoveBottom:s[5]||(s[5]=e=>ue(e,T.value,"resize-bottom"))},null,8,["id","x","y","width","height","is-active","is-resize-area","is-shadow","is-readonly","title","isTitle"])):o("",!0),y(e.$slots,"last")]))])],34))}};export{P as default};
