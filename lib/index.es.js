import{computed as e,createElementBlock as i,openBlock as t,normalizeClass as a,createCommentVNode as o,toDisplayString as l,createBlock as r,createVNode as s,withModifiers as u,useTemplateRef as n,ref as d,watch as h,onBeforeUnmount as g,mergeModels as v,useModel as c,unref as m,createElementVNode as p,Fragment as y,renderList as k}from"vue";const w="marking",_="move-rect",f="resize-left",M="resize-right",x="resize-top",z="resize-bottom",R=["x","y","width","height"],S={key:0},T={__name:"MarkUpRect",props:["x","y","width","height","isActive","isDragging","isVertical","isHorizontal","isProc","isShadow","title","isTitle"],setup(r){const s=r,u=e=>s.isProc&&(e=>!String(e).includes("px"))(e),n=e(()=>u(s.x)?`${s.x}%`:s.x),d=e(()=>u(s.y)?`${s.y}%`:s.y),h=e(()=>u(s.width)?`${s.width}%`:s.width),g=e(()=>u(s.height)?`${s.height}%`:s.height),v=e(()=>s.isTitle&&s?.title),c=e(()=>({"mark-up__rect_active":s.isActive,"mark-up__rect_dragging":s.isDragging,"mark-up__rect_vertical":s.isVertical,"mark-up__rect_horizontal":s.isHorizontal,"mark-up__rect_shadow":s.isShadow}));return(e,r)=>(t(),i("rect",{x:n.value,y:d.value,width:h.value,height:g.value,class:a(["mark-up__rect",c.value])},[v.value?(t(),i("title",S,"\r\n      "+l(s.title)+"\r\n    ",1)):o("",!0)],10,R))}},A=["id"],D={key:1},b="5px",I={__name:"MarkUpGroup",props:["x","y","id","width","height","isActive","isUnvisible","isResizeArea","isDragging","isProc","isShadow","isReadonly","title","isTitle"],emits:["move-left","move-right","move-top","move-bottom"],setup(l,{emit:n}){const d=n,h=l,g=e(()=>!(h.isReadonly||!h.isResizeArea)),v=e(()=>["mark-up__g",{"mark-up__g_active":h.isActive,"mark-up__g_unvisible":h.isUnvisible}]);return(e,n)=>(t(),i("g",{id:h.id,class:a(v.value)},[h.isShadow?(t(),r(T,{key:0,x:h.x,y:h.y,width:l.width,height:l.height,"is-shadow":!0,"is-proc":h.isProc},null,8,["x","y","width","height","is-proc"])):o("",!0),s(T,{x:h.x,y:h.y,width:l.width,height:l.height,title:l.title,"is-title":l.isTitle,"is-active":h.isActive,"is-dragging":h.isDragging,"is-proc":h.isProc},null,8,["x","y","width","height","title","is-title","is-active","is-dragging","is-proc"]),g.value?(t(),i("g",D,[s(T,{x:h.x,y:h.y,width:b,height:l.height,"is-vertical":!0,"is-proc":h.isProc,onMousedown:n[0]||(n[0]=u(e=>d("move-left",e),["stop"])),onTouchstart:n[1]||(n[1]=u(e=>d("move-left",e),["stop"]))},null,8,["x","y","height","is-proc"]),s(T,{x:h.x+l.width,y:h.y,width:b,height:l.height,"is-vertical":!0,"is-proc":h.isProc,onMousedown:n[2]||(n[2]=u(e=>d("move-right",e),["stop"])),onTouchstart:n[3]||(n[3]=u(e=>d("move-right",e),["stop"]))},null,8,["x","y","height","is-proc"]),s(T,{x:h.x,y:h.y,width:l.width,height:b,"is-horizontal":!0,"is-proc":h.isProc,onMousedown:n[4]||(n[4]=u(e=>d("move-top",e),["stop"])),onTouchstart:n[5]||(n[5]=u(e=>d("move-top",e),["stop"]))},null,8,["x","y","width","is-proc"]),s(T,{x:h.x,y:h.y+l.height,width:l.width,height:b,"is-horizontal":!0,"is-proc":h.isProc,onMousedown:n[6]||(n[6]=u(e=>d("move-bottom",e),["stop"])),onTouchstart:n[7]||(n[7]=u(e=>d("move-bottom",e),["stop"]))},null,8,["x","y","width","is-proc"])])):o("",!0)],10,A))}},U=(e,i=!1)=>{let t=e.offsetX,a=e.offsetY;if(e.targetTouches){const{left:o,top:l}=e.target.getBoundingClientRect(),{pageX:r,pageY:s}=e.targetTouches[0];t=i?r-o:r,a=i?s-l:s}return{x:t,y:a}},H={class:"mark-up__wrapper"},B=["src"],G={class:"mark-up__svg"},W={__name:"MarkUp",props:v({imageSrc:{type:[Object,String]},isMarkup:{type:Boolean,default:!0},enableGrid:{type:Boolean,default:!1},gridSize:{type:[Number,String],default:10,validator:e=>["5","10","15","20","25","30","35","40","45","50",5,10,15,20,25,30,35,40,45,50].includes(e)},minWidth:{type:[Number,String],default:10},minHeight:{type:[Number,String],default:10},isResizeArea:{type:Boolean,default:!0},isDraggingArea:{type:Boolean,default:!0},isReadonly:{type:Boolean,default:!1},resolution:{type:String,default:"HD",validator:e=>["16:9","HD","10:9","CIF","8:5","QHD","5:6","MPEG2","5:4","SXGA","5:3","WVGA","4:3","VGA","3:1","WSXGA","2:1","2K","1:1"].includes(e)},vertical:{type:Boolean,default:!1},isShadow:{type:Boolean,default:!1},theme:{type:String,default:"default"},isTitle:{type:Boolean,default:!0},keyTitle:{type:String,default:"title"}},{modelValue:{default:[]},modelModifiers:{},activeId:{default:null},activeIdModifiers:{}}),emits:v(["is-load-image","get-sizes"],["update:modelValue","update:activeId"]),setup(l,{emit:s}){const v=c(l,"modelValue"),R=c(l,"activeId"),S=d({}),T=s,A=l,{widthMarkUp:D,heightMarkUp:b,convToPercent:W,convToRealWidth:P,convToRealHeight:V,minWidth:L,minHeight:X,imgSrc:C,isLoadImg:N}=((i,{changeIsLoadImage:t,getSizes:a})=>{const o=n("img"),l=d(null),r=d(null),s=d(null),u=d(null),v=d(!1),c=()=>{v.value=!1,l.value=null,r.value=null,s.value=null,u.value=null},m=e(()=>{if(i.imageSrc&&"object"==typeof i.imageSrc){const e=new Blob(i.imageSrc,{type:"image"});return URL.createObjectURL(e)}return i.imageSrc&&"string"==typeof i.imageSrc?i.imageSrc:null}),p=()=>{if(m.value){const e=o.value.offsetHeight;l.value=o.value.offsetWidth,r.value=e,s.value=o.value.naturalWidth,u.value=o.value.naturalHeight,v.value=e>0}m.value||c()};let y;const k=()=>{y&&y.disconnect()},w=(e,i)=>e/i*100,_=(e,i)=>e*i.value/100,f=e(()=>w(i.minWidth,l.value)),M=e(()=>w(i.minHeight,r.value));return h(m,e=>{const i=new Image;i.src=e,i.onload=p,i.onerror=c},{immediate:!0}),h(v,t),h(o,e=>{e||k(),e&&(k(),y=new ResizeObserver(p),y.observe(e))}),h([l,r,s,u],()=>{a({widthImage:l.value,heightImage:r.value,realWidthImage:s.value,realHeightImage:u.value})}),g(k),{widthMarkUp:l,heightMarkUp:r,convToPercent:w,convToRealWidth:e=>_(e,l),convToRealHeight:e=>_(e,r),minWidth:f,minHeight:M,imgSrc:m,isLoadImg:v}})(A,{changeIsLoadImage:e=>T("is-load-image",e),getSizes:e=>T("get-sizes",e)});h(C,()=>{v.value=[],R.value=null,S.value={}});let E=null,$=null;const{markUpArea:F,startMarkup:j,marking:K,mDownMarking:O,mUpMarking:Q}=((e,{addInAreas:i,widthMarkUp:t,heightMarkUp:a})=>{const o=(e,i)=>e>i?i:e,l=e=>e<0?0:e,r=(e,i)=>e<0?i+e:i,s=d({}),u=d(!1);let n=null,h=null;return{markUpArea:s,startMarkup:u,marking:e=>{if(u.value&&n&&h){const{x:i,y:u}=U(e,!0),d=({sizeBlock:e,coord:i,size:t})=>{const a=i+t;return a>e?t-(a-e):t},g=o(n,i),v=o(h,u),c=d({sizeBlock:t.value,coord:g,size:Math.abs(n-i)}),m=d({sizeBlock:a.value,coord:v,size:Math.abs(h-u)});s.value={id:Date.now(),x:l(g),y:l(v),width:r(g,c),height:r(v,m)}}},mDownMarking:i=>{if(e.isMarkup){const{x:e,y:t}=U(i,!0);u.value=!0,n=e,h=t}},mUpMarking:()=>{if(e.isMarkup){u.value=!1,n=null,h=null;const t=s.value.width>=e.minWidth,a=s.value.height>=e.minHeight;t&&a&&i(s.value,s.value.id),s.value={}}}}})(A,{addInAreas:(e,i)=>{const t=(e=>{const{x:i,y:t,width:a,height:o}=e;return{...e,x:W(i,D.value),y:W(t,b.value),width:W(a,D.value),height:W(o,b.value)}})(e);v.value=[{...t},...v.value],R.value=i},widthMarkUp:D,heightMarkUp:b}),{isMovRect:Y,mUpRect:q,mDownRect:J,moveRect:Z,resizeRect:ee}=(({cRectParam:e,convToRealWidth:i,convToRealHeight:t})=>{const a=d(!1);let o=null,l=null,r=null,s=null,u=null,n=null;const h=(e,i,t)=>i>=t?e+(i-t):e-(t-i),g=(e,i,t)=>i>=t?e-(i-t):e+(t-i);return{isMovRect:a,mUpRect:()=>{a.value=!1,o=null,l=null,r=null,s=null,u=null,n=null},mDownRect:(e,d)=>{const{x:h,y:g}=U(e);if(a.value=!0,o=h,l=g,d?.id){const{x:e,y:a,width:o,height:l}=d;r=i(e),s=t(a),u=i(o),n=t(l)}},moveRect:i=>{const{x:t,y:a}=U(i),u=h(r,t,o),n=h(s,a,l);e({x:u,y:n})},resizeRect:(i,t)=>{if(t===f){const{x:t}=U(i),a=h(r,t,o);if(a<r+u){const i=g(u,t,o);e({x:a,width:i})}}if(t===M){const{x:t}=U(i),a=h(u,t,o);e({width:a})}if(t===x){const{y:t}=U(i),a=h(s,t,l);if(a<s+n){const i=g(n,t,l);e({y:a,height:i})}}if(t===z){const{y:t}=U(i),a=h(n,t,l);e({height:a})}}}})({cRectParam:e=>{if(null!==$){let i=(({x:e,y:i,width:t,height:a})=>{let o={};return e&&(o={...o,x:W(e,D.value)}),i&&(o={...o,y:W(i,b.value)}),t&&(o={...o,width:W(t,D.value)}),a&&(o={...o,height:W(a,b.value)}),o})(e);i={...v.value[$],...i},((e,i)=>{const{x:t,y:a,width:o,height:l}=i;let r=l>=X.value&&o>=L.value;return e===f&&t<0&&(r=!1),e===M&&t+o>100&&(r=!1),e===z&&a+l>100&&(r=!1),e===x&&a<0&&(r=!1),r})(E,i)&&(E===_&&(i=(e=>{const i={...e};return i.x<0&&(i.x=0),i.y<0&&(i.y=0),i.x+i.width>100&&(i.x+=100-(i.x+i.width)),i.y+i.height>100&&(i.y+=100-(i.y+i.height)),i})(i)),v.value[$]={...i},S.value={...i})}},convToRealWidth:P,convToRealHeight:V}),ie=e=>{E=e},te=e(()=>!A.isReadonly&&null!==C.value),ae=e(()=>!!te.value&&(A.isMarkup||A.isResizeArea||A.isDraggingArea)),oe=e=>{if(ae.value&&e.preventDefault(),E&&te.value){const i=E===_&&A.isDraggingArea,t=!i&&E!==w,a=i=>{E===i&&ee(e,i)};E===w&&K(e),i&&Z(e),t&&a(E)}},le=e=>{ae.value&&e.preventDefault(),te.value&&(ie(w),O(e))},re=e=>{ae.value&&e.preventDefault(),te.value&&(E===w&&Q(),q(),ie(null))},se=(e,i,t)=>{ae.value&&e.preventDefault();const a=e=>R.value=e;if(!A.isReadonly&&null!==C.value)if(t!==_||A.isDraggingArea){if(ie(t),J(e,i),i?.id){const{id:e}=i;a(e),$=v.value.findIndex(i=>i.id===e)}}else i?.id&&a(i.id)},ue=((i,{startMarkup:t,isMovRect:a,isLoadImg:o})=>e(()=>[`mark-up_theme_${i.theme}`,{"mark-up_start":t.value,"mark-up_rect-move":a.value,"mark-up_rect-no-move":!i.isDraggingArea,"mark-up_readonly":i.isReadonly,"mark-up_is-image":o.value,"mark-up_no-markup":!i.isMarkup,"mark-up_grid":i.enableGrid,"mark-up_grid-10":10==i.gridSize,"mark-up_grid-15":15==i.gridSize,"mark-up_grid-20":20==i.gridSize,"mark-up_grid-25":25==i.gridSize,"mark-up_grid-30":30==i.gridSize,"mark-up_grid-35":35==i.gridSize,"mark-up_grid-40":40==i.gridSize,"mark-up_grid-45":45==i.gridSize,"mark-up_grid-50":50==i.gridSize,"mark-up_vertical":i.vertical,"mark-up_16-9":"16:9"===i.resolution,"mark-up_HD":"HD"===i.resolution,"mark-up_10-9":"10:9"===i.resolution,"mark-up_CIF":"CIF"===i.resolution,"mark-up_8-5":"8:5"===i.resolution,"mark-up_QHD":"QHD"===i.resolution,"mark-up_5-6":"5:6"===i.resolution,"mark-up_MPEG2":"MPEG2"===i.resolution,"mark-up_5-4":"5:4"===i.resolution,"mark-up_SXGA":"SXGA"===i.resolution,"mark-up_5-3":"5:3"===i.resolution,"mark-up_WVGA":"WVGA"===i.resolution,"mark-up_4-3":"4:3"===i.resolution,"mark-up_VGA":"VGA"===i.resolution,"mark-up_3-1":"3:1"===i.resolution,"mark-up_WSXGA":"WSXGA"===i.resolution,"mark-up_2-1":"2:1"===i.resolution,"mark-up_2K":"2K"===i.resolution,"mark-up_1-1":"1:1"===i.resolution}]))(A,{startMarkup:j,isMovRect:Y,isLoadImg:N});return h(R,e=>S.value=v.value.find(i=>i.id===e)),(e,s)=>(t(),i("div",{class:a(["mark-up",m(ue)]),onMousedown:le,onMousemove:oe,onMouseup:re,onTouchstart:le,onTouchmove:oe,onTouchend:re},[p("div",H,[m(C)?(t(),i("img",{key:0,src:m(C),ref:"img",class:"mark-up__img",alt:""},null,8,B)):o("",!0),(t(),i("svg",G,[(t(!0),i(y,null,k(v.value,e=>(t(),r(I,{key:e.id,id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,"is-unvisible":R.value===e.id&&!A.isReadonly,"is-resize-area":A.isResizeArea,"is-proc":!0,"is-shadow":A.isShadow,"is-readonly":l.isReadonly,title:e[A.keyTitle],isTitle:A.isTitle,onTouchstart:u(i=>se(i,e,"move-rect"),["stop"]),onMousedown:u(i=>{se(i,e,"move-rect")},["stop"]),onMoveLeft:i=>se(i,e,"resize-left"),onMoveRight:i=>se(i,e,"resize-right"),onMoveTop:i=>se(i,e,"resize-top"),onMoveBottom:i=>se(i,e,"resize-bottom")},null,8,["id","x","y","width","height","is-unvisible","is-resize-area","is-shadow","is-readonly","title","isTitle","onTouchstart","onMousedown","onMoveLeft","onMoveRight","onMoveTop","onMoveBottom"]))),128)),m(F)?.id?(t(),r(I,{key:0,id:m(F).id,x:m(F).x,y:m(F).y,width:m(F).width,height:m(F).height,"is-active":!0,"is-dragging":!0,"is-proc":!1,"is-shadow":A.isShadow,"is-readonly":l.isReadonly},null,8,["id","x","y","width","height","is-shadow","is-readonly"])):o("",!0),S.value?.id?(t(),r(I,{key:1,id:S.value.id,x:S.value.x,y:S.value.y,width:S.value.width,height:S.value.height,"is-active":R.value===S.value.id&&!A.isReadonly,"is-resize-area":A.isResizeArea,"is-proc":!0,"is-shadow":A.isShadow,"is-readonly":l.isReadonly,title:S.value[A.keyTitle],isTitle:A.isTitle,onTouchstart:s[0]||(s[0]=u(e=>se(e,S.value,"move-rect"),["stop"])),onMousedown:s[1]||(s[1]=u(e=>se(e,S.value,"move-rect"),["stop"])),onMoveLeft:s[2]||(s[2]=e=>se(e,S.value,"resize-left")),onMoveRight:s[3]||(s[3]=e=>se(e,S.value,"resize-right")),onMoveTop:s[4]||(s[4]=e=>se(e,S.value,"resize-top")),onMoveBottom:s[5]||(s[5]=e=>se(e,S.value,"resize-bottom"))},null,8,["id","x","y","width","height","is-active","is-resize-area","is-shadow","is-readonly","title","isTitle"])):o("",!0)]))])],34))}};export{W as default};
